# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the master branch
  push:
    branches: [ pipeline-dev ]
  pull_request:
    branches: [ pipeline-dev ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v3

      # Move all files EXCEPT the newly created folder into the folder
      # grep -v  inverts selection
      # grep -E  uses regex
      # '^Blaize_V3$|\.|\..'  matches "Blaize_V3", "." and ".." directories
      # ^Blaize_V3$  selects only "Blaize_V3" (directory) and not "Blaize_V3.pde" (file)
      - name: Move sketch files to sketch folder
        run:
          mkdir Blaize_V3;
          ls -a | grep -v -E '^Blaize_V3$|\.|\..' | xargs mv --target-directory=Blaize_V3;
          ls -al;
          ls -al Blaize_V3;
          
      - name: Download processing
        run: wget https://github.com/processing/processing/releases/download/processing-0270-3.5.4/processing-3.5.4-linux64.tgz
      
      - name: Unpack Processing
        run: tar zxvf processing-3.5.4-linux64.tgz
      
      - name: ll
        run:
          cd processing-3.5.4;
          ls -al;
      
      - name: Build App
        run:
          cd processing-3.5.4;
          ./processing-java --sketch=../Blaize_V3 --build;
